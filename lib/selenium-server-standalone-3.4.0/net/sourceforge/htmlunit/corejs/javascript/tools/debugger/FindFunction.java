package net.sourceforge.htmlunit.corejs.javascript.tools.debugger;

import java.awt.Component;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.Arrays;
import javax.swing.BorderFactory;
import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.DefaultListModel;
import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JRootPane;
import javax.swing.JScrollPane;





















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































class FindFunction
  extends JDialog
  implements ActionListener
{
  private static final long serialVersionUID = 559491015232880916L;
  private String value;
  private JList list;
  private SwingGui debugGui;
  private JButton setButton;
  private JButton cancelButton;
  
  public FindFunction(SwingGui debugGui, String title, String labelText)
  {
    super(debugGui, title, true);
    this.debugGui = debugGui;
    
    cancelButton = new JButton("Cancel");
    setButton = new JButton("Select");
    cancelButton.addActionListener(this);
    setButton.addActionListener(this);
    getRootPane().setDefaultButton(setButton);
    
    list = new JList(new DefaultListModel());
    DefaultListModel model = (DefaultListModel)list.getModel();
    model.clear();
    
    String[] a = dim.functionNames();
    Arrays.sort(a);
    for (int i = 0; i < a.length; i++) {
      model.addElement(a[i]);
    }
    list.setSelectedIndex(0);
    
    setButton.setEnabled(a.length > 0);
    list.setSelectionMode(1);
    list.addMouseListener(new MouseHandler());
    JScrollPane listScroller = new JScrollPane(list);
    listScroller.setPreferredSize(new Dimension(320, 240));
    listScroller.setMinimumSize(new Dimension(250, 80));
    listScroller.setAlignmentX(0.0F);
    




    JPanel listPane = new JPanel();
    listPane.setLayout(new BoxLayout(listPane, 1));
    JLabel label = new JLabel(labelText);
    label.setLabelFor(list);
    listPane.add(label);
    listPane.add(Box.createRigidArea(new Dimension(0, 5)));
    listPane.add(listScroller);
    listPane.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
    

    JPanel buttonPane = new JPanel();
    buttonPane.setLayout(new BoxLayout(buttonPane, 0));
    buttonPane.setBorder(BorderFactory.createEmptyBorder(0, 10, 10, 10));
    buttonPane.add(Box.createHorizontalGlue());
    buttonPane.add(cancelButton);
    buttonPane.add(Box.createRigidArea(new Dimension(10, 0)));
    buttonPane.add(setButton);
    

    Container contentPane = getContentPane();
    contentPane.add(listPane, "Center");
    contentPane.add(buttonPane, "South");
    pack();
    addKeyListener(new KeyAdapter()
    {
      public void keyPressed(KeyEvent ke) {
        int code = ke.getKeyCode();
        if (code == 27) {
          ke.consume();
          value = null;
          setVisible(false);
        }
      }
    });
  }
  


  public String showDialog(Component comp)
  {
    value = null;
    setLocationRelativeTo(comp);
    setVisible(true);
    return value;
  }
  




  public void actionPerformed(ActionEvent e)
  {
    String cmd = e.getActionCommand();
    if (cmd.equals("Cancel")) {
      setVisible(false);
      value = null;
    } else if (cmd.equals("Select")) {
      if (list.getSelectedIndex() < 0) {
        return;
      }
      try {
        value = ((String)list.getSelectedValue());
      } catch (ArrayIndexOutOfBoundsException exc) {
        return;
      }
      setVisible(false);
      Dim.FunctionSource item = debugGui.dim.functionSourceByName(value);
      if (item != null) {
        Dim.SourceInfo si = item.sourceInfo();
        String url = si.url();
        int lineNumber = item.firstLine();
        debugGui.showFileWindow(url, lineNumber);
      }
    }
  }
  
  class MouseHandler extends MouseAdapter
  {
    MouseHandler() {}
    
    public void mouseClicked(MouseEvent e)
    {
      if (e.getClickCount() == 2) {
        setButton.doClick();
      }
    }
  }
}
