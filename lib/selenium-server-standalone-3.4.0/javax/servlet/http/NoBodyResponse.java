package javax.servlet.http;

import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.io.UnsupportedEncodingException;
import java.util.ResourceBundle;
import javax.servlet.ServletOutputStream;
























































































































































































































































































































































































































































































































































































































































































































































































































class NoBodyResponse
  extends HttpServletResponseWrapper
{
  private static final ResourceBundle lStrings = ResourceBundle.getBundle("javax.servlet.http.LocalStrings");
  
  private NoBodyOutputStream noBody;
  
  private PrintWriter writer;
  private boolean didSetContentLength;
  private boolean usingOutputStream;
  
  NoBodyResponse(HttpServletResponse r)
  {
    super(r);
    noBody = new NoBodyOutputStream();
  }
  
  void setContentLength()
  {
    if (!didSetContentLength) {
      if (writer != null) {
        writer.flush();
      }
      setContentLength(noBody.getContentLength());
    }
  }
  
  public void setContentLength(int len)
  {
    super.setContentLength(len);
    didSetContentLength = true;
  }
  
  public void setContentLengthLong(long len)
  {
    super.setContentLengthLong(len);
    didSetContentLength = true;
  }
  
  public void setHeader(String name, String value)
  {
    super.setHeader(name, value);
    checkHeader(name);
  }
  
  public void addHeader(String name, String value)
  {
    super.addHeader(name, value);
    checkHeader(name);
  }
  
  public void setIntHeader(String name, int value)
  {
    super.setIntHeader(name, value);
    checkHeader(name);
  }
  
  public void addIntHeader(String name, int value)
  {
    super.addIntHeader(name, value);
    checkHeader(name);
  }
  
  private void checkHeader(String name) {
    if ("content-length".equalsIgnoreCase(name)) {
      didSetContentLength = true;
    }
  }
  
  public ServletOutputStream getOutputStream()
    throws IOException
  {
    if (writer != null) {
      throw new IllegalStateException(lStrings.getString("err.ise.getOutputStream"));
    }
    
    usingOutputStream = true;
    
    return noBody;
  }
  
  public PrintWriter getWriter()
    throws UnsupportedEncodingException
  {
    if (usingOutputStream) {
      throw new IllegalStateException(lStrings.getString("err.ise.getWriter"));
    }
    

    if (writer == null) {
      OutputStreamWriter w = new OutputStreamWriter(noBody, getCharacterEncoding());
      
      writer = new PrintWriter(w);
    }
    
    return writer;
  }
}
